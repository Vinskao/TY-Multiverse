<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hagishi</title>
    <style>
        #system {
          align-items: center;
          padding-left: -50px;
          margin-left: -50px;
        }
        .title {
          text-align: center;
          flex-direction: row;
          display: flex;
          z-index: 999;
          padding-left: 30px;
  
        }
        #cardList li {
          margin: 0;
          list-style-type: none;
        }
        .container {
          display: flex;
          flex-direction: row;
          position: relative;
          columns: 2;
        }
        .powers-container {
          font-size: 10px;
          text-align: center;
        }
        #attrHagisun,
        #attrHagishi,
        #attrRapeharem,
        #attrMutav,
        #attrLibertad {
          margin: 0;
          padding: 0;
        }
        #totalPhysicPowerHagishi,
        #totalMagicPowerHagishi,
        #totalUtilityPowerHagishi,
        #totalPhysicPowerHagisun,
        #totalMagicPowerHagisun,
        #totalUtilityPowerHagisun,
        #totalPhysicPowerRapeharem,
        #totalMagicPowerRapeharem,
        #totalUtilityPowerRapeharem,
        #totalPhysicPowerMutav,
        #totalMagicPowerMutav,
        #totalUtilityPowerMutav,
        #totalHagishi,
        #totalHagisun,
        #totalRapeharem,
        #totalMutav,
        #attrHagisun,
        #attrHagishi,
        #attrRapeharem,
        #attrMutav,
        #totalPhysicPowerLibertad,
        #totalMagicPowerLibertad,
        #totalUtilityPowerLibertad,
        #totalLibertad,
        #attrLibertad {
          flex: 1;
          font-size: 12px;
          margin: 0;
          padding: 0;
        }
        #cardImagesLibertad,
        #cardImagesRapeharem,
        #cardImagesHagisun,
        #cardImagesHagishi,
        #cardImagesMutav,
        #cardImagesAll {
          white-space: nowrap;
          overflow-x: auto;
          padding-right: 90px;
        }
      </style>
      <script
        async
        src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"
      ></script>
      <script
        async
        defer
        src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.2.2/d3.min.js"></script>
</head>
<body>
    <div id="system">
        <div class="title">
          <button id="getHagishiButton" onclick="getHagishi()">+ 八食</button>
          <h4>八食</h4>
        </div>
        <div id="cardImagesHagishi"></div>
        <div class="powers-container">
          <div id="totalPhysicPowerHagishi">Hagishi 力：0</div>
          <div id="totalMagicPowerHagishi">Hagishi 魔：0</div>
          <div id="totalUtilityPowerHagishi">Hagishi 術：0</div>
          <div id="totalHagishi">總能力：0</div>
          <div id="attrHagishi">屬性：</div>
        </div>
      </div>

      <script>
        document.addEventListener("DOMContentLoaded", function () {
          // var dataPoints = [];
          $.getJSON(
            // callback function
            "https://firebasestorage.googleapis.com/v0/b/graph-2cfc7.appspot.com/o/palais.json?alt=media&token=a12f751a-3a31-4931-ab7e-b5de12e85015&_gl=1*u5u5sm*_ga*MTYxNzczOTU2MC4xNjk1MzQ5OTI4*_ga_CW55HF8NVT*MTY5OTI3NTE2Mi45LjEuMTY5OTI3NTk2MS40MS4wLjA.",
            function (response) {
              var jsonData = response;
             
              const cards = jsonData.map((item) => ({
                id: item.id,
                name_original: item.name_original,
                code_name: item.code_name,
                name: item.name,
                physic_power: item.physic_power,
                magic_power: item.magic_power,
                utility_power: item.utility_power,
                dob: item.dob,
                race: item.race,
                attributes: item.attributes,
                gender: item.gender,
                ass_size: item.ass_size,
                boobs_size: item.boobs_size,
                height_cm: item.height_cm,
                weight_kg: item.weight_kg,
                army_name: item.army_name,
                dept_name: item.dept_name,
                profession: item.profession,
                combat: item.combat,
                favorite_foods: item.favorite_foods,
                job: item.job,
                physics: item.physics,
                known_as: item.known_as,
                personally: item.personally,
                concubine: item.concubine,
                main_weapon: item.main_weapon,
                sub_weapon: item.sub_weapon,
                interest: item.interest,
                likes: item.likes,
                dislikes: item.dislikes,
                faction: item.faction,
                gave_birth: item.gave_birth,
                origin_army_name: item.origin_army_name
  
              }));
                
              var imageNamesHagishi = [
                "Wavo.png",
                "Chiaki.png",
                "Sayuri.png",
                "Hitomi.png",
                "Yuko.png",
                "Etsuko.png",
                "Masako.png",
                "Miku.png",
              ];
              
              var containerIdHagishi = "cardImagesHagishi";
  
              function getHagishi() {
                var cardImagesContainer =
                  document.getElementById(containerIdHagishi);
                cardImagesContainer.innerHTML = "";
                var totalPhysicPower = 0;
                var totalMagicPower = 0;
                var totalUtilityPower = 0;
                var selectedCardNames = []; // 存储选中的卡片名称
                var selectedCardAttributes = []; // 存储选中的卡片属性
  
                var availableImages = imageNamesHagishi.slice();
                for (var i = 0; i < 4; i++) {
                  var randomIndex = Math.floor(
                    Math.random() * availableImages.length
                  );
                  var selectedImageName = availableImages[randomIndex];
                  availableImages.splice(randomIndex, 1);
                  selectedCardNames.push(selectedImageName.split(".")[0]);
  
                  var selectedCard = cards.find(
                    (card) => card.name === selectedImageName.split(".")[0]
                  );
  
                  if (selectedCard) {
                    totalPhysicPower += selectedCard.physic_power;
                    totalMagicPower += selectedCard.magic_power;
                    totalUtilityPower += selectedCard.utility_power;
                    var imageUrl = `/assets/person/${selectedImageName}`;
                    var imageContainer =
                      document.getElementById(containerIdHagishi);
                    var image = document.createElement("img");
                    image.src = imageUrl;
                    image.alt = "Card";
                    image.style.width = "200px";
                    image.style.height = "auto";
                    image.style.marginRight = "-95px";
                    imageContainer.appendChild(image);
                  }
                }
  
                var totalPhysicPowerElement = document.getElementById(
                  "totalPhysicPowerHagishi"
                );
                var totalMagicPowerElement = document.getElementById(
                  "totalMagicPowerHagishi"
                );
                var totalUtilityPowerElement = document.getElementById(
                  "totalUtilityPowerHagishi"
                );
                var totalHagishiElement = document.getElementById("totalHagishi");
                var attrHagishiElement = document.getElementById("attrHagishi");
  
                // 更新 Hagishi 的物理和魔法能力值
                totalPhysicPowerElement.textContent =
                  "Hagishi 力：" + totalPhysicPower;
                totalMagicPowerElement.textContent =
                  "Hagishi 魔：" + totalMagicPower;
                totalUtilityPowerElement.textContent =
                  "Hagishi 術：" + totalUtilityPower;
  
                // 获取选中卡片的属性
                selectedCardAttributes = cards
                  .filter((card) => selectedCardNames.includes(card.name))
                  .map((card) => card.attributes);
                attrHagishiElement.textContent =
                  "屬性：" + selectedCardAttributes.join(", ");

                // 计算并更新总能力值
                var totalPower =
                  totalPhysicPower + totalMagicPower + totalUtilityPower;
                totalHagishiElement.textContent =
                  "總能力：" + totalPower;
              }

              var getHagishiButton = document.getElementById("getHagishiButton");
              getHagishiButton.addEventListener("click", function () {
                getHagishi();
              });
            }
          );
        });
      </script>
</body>
</html>